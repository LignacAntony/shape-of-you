{% extends 'base.html.twig' %}

{% block title %}{{ wardrobe.name }}{% endblock %}

{% block body %}
    {# On récupère les tenues uniques à partir des outfitItems #}
    {% set outfits = [] %}
    {% for item in wardrobe.outfitItems %}
        {% for outfit in item.outfits %}
            {% if outfit not in outfits %}
                {% set outfits = outfits|merge([outfit]) %}
            {% endif %}
        {% endfor %}
    {% endfor %}

    <div class="container-fluid max-w-7xl mx-auto px-4 py-6">
        {# Bouton retour #}
        {% include 'components/back_button.html.twig' %}

        {# Fil d'ariane #}
        {% include 'components/breadcrumb.html.twig' %}

        {# Section principale #}
        {% embed 'components/wardrobe_card.html.twig' with {
            'name': wardrobe.name,
            'description': wardrobe.description,
            'image': wardrobe.image,
            'stats': [
                {'color': 'primary', 'value': wardrobe.outfitItems|length, 'label': 'vêtements'},
                {'color': 'success', 'value': outfits|length, 'label': 'tenues'}
            ]
        } %}
            {% block card_content %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="flex items-center text-gray-600">
                        <i class="far fa-calendar-alt mr-3 text-gray-500"></i>
                        <span>Créée le {{ wardrobe.createdAt|date('d/m/Y') }}</span>
                    </div>
                    <div class="flex items-center text-gray-600">
                        <i class="fas fa-user mr-3 text-gray-500"></i>
                        <span>Par {{ wardrobe.author.username }}</span>
                    </div>
                </div>
            {% endblock %}
        {% endembed %}

        {# Section Tenues #}
        {% embed 'components/category_section.html.twig' with {
            'title': 'Tenues',
            'icon': 'tshirt',
            'color': 'success',
            'items': outfits,
            'empty_message': 'Aucune tenue n\'a été créée dans cette garde-robe.'
        } %}
            {% block button %}
                {% include 'components/add_outfit_modal.html.twig' with {
                    'wardrobe': wardrobe,
                    'form': outfit_form
                } %}
            {% endblock %}
            
            {% block items %}
                {% for outfit in outfits %}
                    {% include 'components/outfit_card.html.twig' with {
                        'outfit': outfit,
                        'color': 'success'
                    } %}
                {% endfor %}
            {% endblock %}
        {% endembed %}

        {# Section Vêtements #}
        {% embed 'components/category_section.html.twig' with {
            'title': 'Vêtements',
            'icon': 'tags',
            'color': 'info',
            'items': wardrobe.outfitItems,
            'empty_message': 'Cette garde-robe ne contient aucun vêtement.'
        } %}
            {% block button %}
                {% include 'components/add_clothing_modal.html.twig' with {
                    'categories': categories,
                    'wardrobe_id': wardrobe.id
                } %}
            {% endblock %}
            
            {% block items %}
                {% for item in wardrobe.outfitItems %}
                    {% include 'components/clothing_card.html.twig' with {
                        'item': item,
                        'color': 'info'
                    } %}
                {% endfor %}
            {% endblock %}
        {% endembed %}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {% include 'components/card_styles.html.twig' %}
{% endblock %} 