{% extends 'base.html.twig' %}

{% block title %}Analyse d'image{% endblock %}

{% block body %}
    <h1>Analyse de l'image pour l'outfit : {{ outfit.name }}</h1>

    {# Formulaire d'upload d'image #}
    <div class="card mb-4">
        <div class="card-header">
            <h2>Télécharger une image</h2>
        </div>
        <div class="card-body">
            {{ form_start(imageForm, {'attr': {'enctype': 'multipart/form-data'}}) }}
            {{ form_widget(imageForm) }}
            <button type="submit" class="btn btn-primary mt-2">Analyser</button>
            {{ form_end(imageForm) }}
        </div>
    </div>

    {# Affichage d'une éventuelle erreur #}
    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    {# Si le formulaire global existe, afficher les résultats de l'analyse et le formulaire pour validation #}
    {% if globalForm is not null %}
        <hr>
        <h2>Résultats de l'analyse</h2>
        <ul>
            {% for clothing in analysis %}
                <li>
                    <strong>{{ clothing.name }}</strong>
                    {% if clothing.category %} - {{ clothing.category }}{% endif %}
                    {% if clothing.brand %} - {{ clothing.brand }}{% endif %}
                    {% if clothing.price %} - {{ clothing.price }} €{% endif %}
                </li>
            {% endfor %}
        </ul>

        <h2>Modifier et ajouter les vêtements détectés</h2>
        {{ form_start(globalForm) }}
        {{ form_widget(globalForm) }}
        <button type="submit" class="btn btn-success mt-2">Ajouter tous les vêtements</button>
        {{ form_end(globalForm) }}
    {% endif %}
{% endblock %}
